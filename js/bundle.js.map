{"version":3,"sources":["node_modules/browserify/node_modules/browser-pack/_prelude.js","src/js/main.js","src/js/idm.js","src/js/models.js","src/js/raf.js","src/js/roadLane.js","src/js/roadNetwork.js","src/js/roadNetworkFactory.js","src/js/roadSegment.js","src/js/vehicle.js"],"names":[],"mappings":"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","file":"bundle.js","sourceRoot":"/source/","sourcesContent":["(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})","import {\n\tcreateRingRoad\n}\nfrom './roadNetworkFactory';\nimport RoadNetwork from './roadNetwork';\nimport RoadSegment from './roadSegment';\nimport raf from './raf';\n\n// polyfill requestAnimationFrame\nraf();\n\n// dt is dynamically changed. See mainLoop.\nlet dt = 0.2;\nlet simulationTime = 0;\nlet iterationCount = 0;\n\nlet running = false;\nlet time;\nlet timeWarp = 4;\n\n\nlet roadLength = 1000;\nlet numberOfLanes = 1;\nlet roadNetwork = createRingRoad(roadLength, numberOfLanes);\n\ndebugger;\nstart();\n\nfunction start() {\n\trunning = true;\n\ttime = new Date().getTime();\n\tmainLoop();\n}\n\nfunction mainLoop() {\n\tif (running) {\n\n\t\trequestAnimationFrame(mainLoop);\n\n\t\tvar now = new Date().getTime();\n\t\tdt = (now - (time || now)) / 1000;\n\t\tdt *= timeWarp;\n\t\ttime = now;\n\n\t\t// update state\n\t\tsimulationTime += dt;\n\t\titerationCount++;\n\t\troadNetwork.timeStep(dt);\n\n\t\t// draw\n\n\t\t// limit iterations for now\n\t\tif (iterationCount >= 1000) {\n\t\t\trunning = false;\n\n\t\t\troadNetwork.roadSegments[0].roadLanes[0].vehicles.forEach(function(vehicle) {\n\t\t\t\tconsole.log('vehicle: ', vehicle.id, '  pos: ', vehicle.position.toFixed(\n\t\t\t\t\t2), '  speed: ', vehicle.speed.toFixed(2), '  acc: ', vehicle.acc.toFixed(\n\t\t\t\t\t4), '   a: ', vehicle.carFollowingModelParameters.a);\n\t\t\t});\n\t\t}\n\n\t\tif (iterationCount % 100 === 0) {\n\t\t\tconsole.log('timeStep: ', dt, ' -- simTime: ', simulationTime,\n\t\t\t\t' -- iterationcount: ', iterationCount);\n\n\t\t\troadNetwork.roadSegments[0].roadLanes[0].vehicles.forEach(function(vehicle) {\n\t\t\t\tconsole.log('vehicle: ', vehicle.id, '  pos: ', vehicle.position.toFixed(\n\t\t\t\t\t2), '  speed: ', vehicle.speed.toFixed(2), '  acc: ', vehicle.acc.toFixed(\n\t\t\t\t\t4), '   a: ', vehicle.carFollowingModelParameters.a);\n\t\t\t});\n\t\t}\n\n\n\t} else {\n\t\tconsole.log('timeStep: ', dt, ' -- simTime: ', simulationTime,\n\t\t\t' -- iterationcount: ', iterationCount);\n\t}\n\n}\n","export default class IdmParameters {\n\n  constructor(v0 = 20, a = 1.2, b = 1.2, T = 1.5, s0 = 2, s1 = 0, delta = 4) {\n    this.v0 = v0;\n    this.a = a;\n    this.b = b;\n    this.T = T;\n    this.s0 = s0;\n    this.s1 = s1;\n    this.delta = delta;\n  }\n\n  static getDefaultCar() {\n    return new IdmParameters();\n  };\n\n  static getDefaultTruck() {\n    let defaultTruck = new IdmParameters();\n    defaultTruck.v0 = 0.8 * defaultTruck.v0;\n    defaultTruck.a = 0.8 * defaultTruck.a;\n    defaultTruck.T = 1.2 * defaultTruck.T;\n    return defaultTruck;\n  };\n\n}\n","import IdmParameters from './idm';\n\n\nlet maxDeceleration = 20;\n\nexport default class Models {\n\n\tstatic idmCalcAcc(s, v, vl, v0eff, parameters) {\n\t\tlet accFree = parameters.a * (1 - Math.pow(v / v0eff, parameters.delta));\n\t\tlet sstar = parameters.s0 + v * parameters.T + parameters.s1 * Math.sqrt((v +\n\t\t\t0.0001) / v0eff) + 0.5 * v * (v - vl) / Math.sqrt(parameters.a *\n\t\t\tparameters.b);\n\t\tlet accInt = -parameters.a * Math.pow(sstar / Math.max(s, parameters.s0), 2);\n\t\treturn Math.max(-maxDeceleration, accFree + accInt);\n\t}\n\n\tstatic calculateAcceleration(s, v, vl, v0eff, parameters) {\n\t\t// TODO check effective speed of instanceof call\n\t\tif (parameters instanceof IdmParameters) {\n\t\t\treturn Models.idmCalcAcc(s, v, vl, v0eff, parameters);\n\t\t} else {\n\t\t\tthrow Error(\"cannot map parameters to acceleration function\" + parameters.toString());\n\t\t}\n\t};\n}\n","// http://paulirish.com/2011/requestanimationframe-for-smart-animating/\n// http://my.opera.com/emoller/blog/2011/12/20/requestanimationframe-for-smart-er-animating\n\n// requestAnimationFrame polyfill by Erik Möller\n// fixes from Paul Irish and Tino Zijdel\n\nexport default function raf() {\n\tvar lastTime = 0;\n\tvar vendors = ['ms', 'moz', 'webkit', 'o'];\n\tfor (var x = 0; x < vendors.length && !window.requestAnimationFrame; ++x) {\n\t\twindow.requestAnimationFrame = window[vendors[x] + 'RequestAnimationFrame'];\n\t\twindow.cancelAnimationFrame = window[vendors[x] + 'CancelAnimationFrame'] ||\n\t\t\twindow[vendors[x] + 'CancelRequestAnimationFrame'];\n\t}\n\n\tif (!window.requestAnimationFrame)\n\t\twindow.requestAnimationFrame = function(callback, element) {\n\t\t\tvar currTime = new Date().getTime();\n\t\t\tvar timeToCall = Math.max(0, 16 - (currTime - lastTime));\n\t\t\tvar id = window.setTimeout(function() {\n\t\t\t\t\tcallback(currTime + timeToCall);\n\t\t\t\t},\n\t\t\t\ttimeToCall);\n\t\t\tlastTime = currTime + timeToCall;\n\t\t\treturn id;\n\t\t};\n\n\tif (!window.cancelAnimationFrame)\n\t\twindow.cancelAnimationFrame = function(id) {\n\t\t\tclearTimeout(id);\n\t\t};\n\n\tconsole.log('requestAnimationFrame set: ', window.requestAnimationFrame);\n}\n","export default class RoadLane {\n\n  constructor(roadSegment) {\n    this.vehicles = [];\n    this.roadSegment = roadSegment;\n    this.sinkLaneSegment = null; //TODO\n    this.sourceLaneSegment = null; //TODO\n  }\n\n  getRoadLength() {\n    return this.roadSegment.roadLength;\n  };\n\n  addVehicle(vehicle) {\n    this.vehicles.push(vehicle);\n  };\n\n  updateVehicleAccelerations() {\n    for (var i = 0, len = this.vehicles.length; i < len; i++) {\n      var vehicle = this.vehicles[i];\n      vehicle.updateAcceleration(this);\n    }\n  };\n\n  updateSpeedAndPosition(dt) {\n    for (var i = 0; i < this.vehicles.length; i++) {\n      var vehicle = this.vehicles[i];\n      vehicle.updateSpeedAndPosition(dt);\n      if (this.roadSegment.parameters.ringRoad && vehicle.position > this.roadSegment\n        .parameters.roadLength) {\n        vehicle.position -= this.roadSegment.parameters.roadLength;\n      }\n    }\n  };\n\n  getLaneRearVehicle() {\n    if (this.vehicles.length > 0) {\n      return this.vehicles[this.vehicles.length - 1];\n    }\n    return null;\n  };\n\n  getLaneFrontVehicle() {\n    if (this.vehicles.length > 0) {\n      return this.vehicles[0];\n    }\n    return null;\n  };\n\n  getRearVehicle(position) {\n    var index = this._positionBinarySearch(position);\n    var insertionPoint = -index - 1;\n    if (index >= 0) {\n      // exact match found, so return the matched vehicle\n      if (index < this.vehicles.length) {\n        return this.vehicles[index];\n      }\n    } else {\n      // get next vehicle if not past end\n      if (insertionPoint < this.vehicles.length) {\n        return this.vehicles[insertionPoint];\n      }\n    }\n    if (this.sourceLaneSegment !== null) {\n      // didn't find a rear vehicle in the current road segment, so\n      // check the previous (source) road segment\n      // and continue until a vehicle is found or no further source is connected to laneSegment\n      var sourceFrontVehicle = null;\n      var source = this.sourceLaneSegment;\n      var accumDistance = 0;\n      do {\n        accumDistance += source.getRoadLength();\n        sourceFrontVehicle = source.laneFrontVehicle();\n        source = source.sourceLaneSegment();\n      } while (sourceFrontVehicle === null && source !== null);\n      if (sourceFrontVehicle !== null) {\n        var newPosition = sourceFrontVehicle.getFrontPosition() -\n          accumDistance;\n        return movsim.simulation.moveable.create(sourceFrontVehicle,\n          newPosition);\n      }\n    }\n    return null;\n  };\n\n  getFrontVehicle(position) {\n    var index = this._positionBinarySearch(position);\n    var insertionPoint = -index - 1;\n    if (index > 0) {\n      return this.vehicles[index - 1]; // exact match found\n    } else if (insertionPoint > 0) {\n      return this.vehicles[insertionPoint - 1];\n    }\n    // index == 0 or insertionPoint == 0\n    // subject vehicle is front vehicle on this road segment, so check for vehicles\n    // on sink lane segment\n    if (this.sinkLaneSegment !== null) {\n      var sinkRearVehicle = null;\n      var sink = this.sinkLaneSegment;\n      var accumDistance = this.getRoadLength();\n      do {\n        sinkRearVehicle = sink.rearVehicle();\n        if (sinkRearVehicle === null) {\n          accumDistance += sink.getRoadLength();\n        }\n        sink = sink.sinkLaneSegment();\n      } while (sinkRearVehicle === null && sink !== null);\n      if (sinkRearVehicle !== null) {\n        var newPosition = sinkRearVehicle.getFrontPosition() + accumDistance;\n        return movsim.simulation.moveable.create(sinkRearVehicle, newPosition);\n      }\n    }\n    return null;\n  };\n\n  updateOutflow(dt) {\n    // remove vehicles with position > this.roadSegment.roadLength (later: assign to linked lane)\n    // for ringroad set vehicle at beginning of lane (periodic boundary conditions)\n    var roadLength = this.roadSegment.roadLength;\n    var vehicle;\n    for (var i = 0, len = this.vehicles.length; i < len; i++) {\n      vehicle = this.vehicles[i];\n      if (vehicle.position > roadLength) {\n        //                this.vehicles.remove(i);\n        // ring road special case TODO remove\n        vehicle.position -= roadLength;\n      }\n    }\n    this._sortVehicles();\n  };\n\n  updateInflow(dt) {\n    // TODO\n  };\n\n  _sortVehicles() {\n    this.vehicles.sort(function(a, b) {\n      return a.position - b.position;\n    });\n  };\n\n  getLeader(vehicle) {\n    var vehicleIndex = this._getPositionInArray(vehicle.id);\n    if (this.vehicles.length <= 1) {\n      return null;\n    }\n    if (vehicleIndex === this.vehicles.length - 1) {\n      return this.roadSegment.ringRoad === true ? this.vehicles[0] : null;\n    }\n    return this.vehicles[vehicleIndex + 1];\n  };\n\n  _getPositionInArray(id) {\n    // TODO es6 -> findIndex\n    var index = this.vehicles.map(function(el) {\n      return el.id;\n    }).indexOf(id);\n    return index;\n  };\n\n}\n","export default class RoadNetwork {\n\n\tconstructor() {\n\t\tthis.roadSegments = [];\n\t\tconsole.log('contructor RoadNetwork')\n\t}\n\n\taddRoadSegment(roadSegment) {\n\t\tthis.roadSegments.push(roadSegment);\n\t\tconsole.log('  added ', roadSegment, ' to roadNetwork', this.roadSegments);\n\t}\n\n\ttimeStep(dt) {\n\t\tthis.roadSegments.forEach(function(roadSegmet) {\n\t\t\troadSegmet.considerLaneChanges(dt);\n\t\t});\n\n\t\tthis.roadSegments.forEach(function(roadSegmet) {\n\t\t\troadSegmet.updateVehicleAccelerations(dt);\n\t\t});\n\n\t\tthis.roadSegments.forEach(function(roadSegmet) {\n\t\t\troadSegmet.updateVehiclePositionsAndSpeeds(dt);\n\t\t});\n\n\t\t// for debugging\n\t\tthis.roadSegments.forEach(function(roadSegmet) {\n\t\t\troadSegmet.checkForInconsistencies(dt);\n\t\t});\n\n\t\tthis.roadSegments.forEach(function(roadSegmet) {\n\t\t\troadSegmet.updateOutflow(dt);\n\t\t});\n\n\t\tthis.roadSegments.forEach(function(roadSegmet) {\n\t\t\troadSegmet.updateInflow(dt);\n\t\t});\n\t}\n\n}\n","import RoadNetwork from './roadNetwork';\nimport RoadSegment from './roadSegment';\n\nexport function createRingRoad(roadLength, numberOfLanes) {\n  var roadNetwork = new RoadNetwork();\n\n  // create one roadSection representing a ring road (anti-clockwise driving direction)\n  var roadSegmentParameters = RoadSegment.getDefaultParameters();\n  roadSegmentParameters.ringRoad = true;\n  roadSegmentParameters.roadLength = roadLength;\n  roadSegmentParameters.numberOfLanes = numberOfLanes;\n  roadSegmentParameters.globalX = 0;\n  roadSegmentParameters.globalY = 200;\n  roadSegmentParameters.heading = 0;\n  roadSegmentParameters.curvature = 2 * Math.PI / roadLength;\n\n  var roadSegment = new RoadSegment(roadSegmentParameters);\n\n  roadNetwork.addRoadSegment(roadSegment);\n  return roadNetwork;\n};\n","import RoadLane from './roadLane';\nimport Vehicle from './vehicle';\nimport IdmParameters from './idm';\n\nexport default class RoadSegment {\n\n\tconstructor(options) {\n\t\tthis.parameters = options;\n\t\tthis.roadLanes = [];\n\t\tthis.numberOfLanes = options.numberOfLanes;\n\n\t\tfor (let i = 1; i <= this.numberOfLanes; i++) {\n\t\t\tlet roadLane = new RoadLane(this);\n\t\t\tthis.roadLanes.push(roadLane);\n\t\t}\n\n\t\tvar vehiclesInOneLane = options.roadLength * options.initDensityPerLane;\n\t\tvar numberOfVehicles = Math.floor(this.numberOfLanes * vehiclesInOneLane);\n\t\tthis._initializeVehicles(numberOfVehicles, options.initTruckFraction);\n\n\t\tconsole.log('constructor RoadSegment');\n\t\tdebugger;\n\t}\n\n\tconsiderLaneChanges(dt) {}\n\n\tupdateVehicleAccelerations(dt) {\n\t\tfor (let i = 0; i < this.numberOfLanes; i++) {\n\t\t\tthis.roadLanes[i].updateVehicleAccelerations(dt);\n\t\t}\n\t}\n\n\tupdateVehiclePositionsAndSpeeds(dt) {\n\t\tfor (let i = 0; i < this.numberOfLanes; i++) {\n\t\t\tthis.roadLanes[i].updateSpeedAndPosition(dt);\n\t\t}\n\t}\n\n\tcheckForInconsistencies(dt) {\n\t\t// TODO implement check for negative vehicle distances\n\t}\n\n\tupdateOutflow(dt) {\n\t\tfor (let i = 0; i < this.numberOfLanes; i++) {\n\t\t\tthis.roadLanes[i].updateOutflow(dt);\n\t\t}\n\t}\n\n\tupdateInflow(dt) {\n\t\tfor (let i = 0; i < this.numberOfLanes; i++) {\n\t\t\tthis.roadLanes[i].updateInflow(dt);\n\t\t}\n\t}\n\n\tstatic getDefaultParameters() {\n\t\tlet roadSectionParameters = {};\n\t\troadSectionParameters.roadLength = 1000;\n\t\troadSectionParameters.numberOfLanes = 1;\n\t\troadSectionParameters.initDensityPerLane = 10 / 1000;\n\t\troadSectionParameters.initTruckFraction = 0.1;\n\t\troadSectionParameters.ringRoad = false;\n\t\troadSectionParameters.globalX = 0;\n\t\troadSectionParameters.globalY = 0;\n\t\troadSectionParameters.heading = 0;\n\t\troadSectionParameters.curvature = 0;\n\t\troadSectionParameters.laneWidth = 10;\n\t\treturn roadSectionParameters;\n\t}\n\n\t_initializeVehicles(numberOfVehicles, truckFraction) {\n\t\tfor (var i = 0; i < numberOfVehicles; i++) {\n\t\t\tvar vehicleParameters = Vehicle.getDefaultParameters();\n\t\t\tvehicleParameters.isTruck = Math.random() < truckFraction;\n\t\t\t// initialize all vehicles with same speed determined by slower trucks\n\t\t\tvehicleParameters.speed = 0.8 * IdmParameters.getDefaultTruck()\n\t\t\t\t.v0;\n\t\t\tvehicleParameters.position = i * 100; // TODO init correctly\n\t\t\tvar vehicle = new Vehicle(vehicleParameters);\n\t\t\tvar lane = i % this.roadLanes.length;\n\t\t\tthis.roadLanes[lane].addVehicle(vehicle);\n\t\t}\n\t};\n}\n","import IdmParameters from './idm';\nimport Models from './models';\n\nvar numberOfCreatedVehicles = 0;\n\nexport default class Vehicle {\n\n\tconstructor(vehicleParameters) {\n\t\tthis.vehicleParameters = vehicleParameters || getDefaultParameters();\n\n\t\t// public variables\n\t\tthis.id = ++numberOfCreatedVehicles;\n\t\tthis.isTruck = vehicleParameters.isTruck;\n\t\tthis.length = vehicleParameters.length;\n\t\tthis.width = vehicleParameters.width;\n\t\tthis.position = vehicleParameters.position;\n\t\tthis.speed = vehicleParameters.speed;\n\t\tthis.acc = vehicleParameters.acc;\n\t\tthis.carFollowingModelParameters = vehicleParameters.isTruck ? IdmParameters\n\t\t\t.getDefaultTruck() : IdmParameters.getDefaultCar();\n\t\tthis.vLimit = this.carFollowingModelParameters.v0; // if effective speed limits, vLimit<v0\n\t\tthis.vMax = this.carFollowingModelParameters.v0; // if vehicle restricts speed, vMax<vLimit, v0\n\t\tconsole.log('contructed vehicle with: ', this.vehicleParameters,\n\t\t\tthis.carFollowingModelParameters);\n\t}\n\n\tgetRearPosition() {\n\t\treturn this.position - 0.5 * this.length;\n\t};\n\n\tgetFrontPosition() {\n\t\treturn this.position + 0.5 * this.length;\n\t};\n\n\tupdateAcceleration(roadLane) {\n\t\t//        var leaderMoveable = roadLane.getFrontVehicle(this.position);\n\n\t\tvar leaderMoveable = roadLane.getLeader(this);\n\n\t\t// TODO if no leader get a pre-defined Moveable set to infinity\n\t\t//if(leaderMoveable === null){\n\t\t//    leaderMoveable = Moveable.getMoveableAtInfinity();\n\t\t// }\n\t\tvar leaderPosition = leaderMoveable ? leaderMoveable.position : 1000000;\n\t\tvar leaderSpeed = leaderMoveable ? leaderMoveable.speed : 100;\n\t\tvar leaderLength = leaderMoveable ? leaderMoveable.length : 0;\n\t\tvar distance = leaderPosition - leaderLength - this.position;\n\t\tif (distance < 0) {\n\t\t\tdistance = 40; // TODO just a hack here\n\t\t\t//throw new Error('negative distance');\n\t\t}\n\n\t\tvar effectiveDesiredSpeed = Math.min(this.carFollowingModelParameters.v0,\n\t\t\tthis.vLimit, this.vMax);\n\t\tthis.acc = Models.calculateAcceleration(distance, this.speed, leaderSpeed,\n\t\t\teffectiveDesiredSpeed, this.carFollowingModelParameters);\n\t};\n\n\tupdateSpeedAndPosition(dt) {\n\t\tthis.position += this.speed * dt + 0.5 * this.acc * dt * dt;\n\t\tthis.speed += this.acc * dt;\n\t\tif (this.speed < 0) {\n\t\t\tthis.speed = 0;\n\t\t}\n\t\t//        console.log('vehicle ', this.id, '   position: ', this.position, '   speed: ', this.speed, '    acc: ', this.acc);\n\t};\n\n\tstatic getDefaultParameters(isTruck = false) {\n\t\tlet vehicleParameters = {};\n\t\tvehicleParameters.isTruck = isTruck;\n\t\tvehicleParameters.length = (isTruck) ? 15 : 7;\n\t\tvehicleParameters.width = (isTruck) ? 3 : 2.5;\n\t\tvehicleParameters.position = 0;\n\t\tvehicleParameters.speed = 0;\n\t\tvehicleParameters.acc = 0;\n\t\treturn vehicleParameters;\n\t};\n}\n"]}